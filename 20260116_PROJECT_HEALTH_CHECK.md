# ğŸ” é¡¹ç›®å®Œæ•´æ€§æ£€æŸ¥æŠ¥å‘Š

> **æ£€æŸ¥æ—¶é—´**: 2026-01-16  
> **æ£€æŸ¥èŒƒå›´**: ä»£ç ã€æ–‡æ¡£ã€é…ç½®ã€æ¶æ„ä¸€è‡´æ€§  
> **çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œå‘ç°éƒ¨åˆ†æ–‡æ¡£è¿‡æ—¶

---

## âœ… å·²éªŒè¯é¡¹ç›®

### 1. æ ¸å¿ƒæ¶æ„ âœ…

| ç»„ä»¶             | çŠ¶æ€ | ä½ç½®                       | è¯´æ˜                   |
| ---------------- | ---- | -------------------------- | ---------------------- |
| **Agent A**      | âœ…   | `server/agents/agent-a.ts` | æ„å›¾è¯†åˆ«ï¼ŒæœåŠ¡ç«¯       |
| **Agent B**      | âœ…   | `server/agents/agent-b.ts` | å†³ç­–ä¸­å¿ƒï¼ŒæœåŠ¡ç«¯       |
| **Agent C**      | âœ…   | `server/agents/agent-c.ts` | çŸ¥è¯†åº“æ£€ç´¢ï¼ŒæœåŠ¡ç«¯     |
| **Agent D**      | âœ…   | `server/agents/agent-d.ts` | ç›‘æ§å½•åƒï¼ŒæœåŠ¡ç«¯       |
| **ANP Bus**      | âœ…   | `server/bus.ts`            | ä»»åŠ¡æ± ç³»ç»Ÿ             |
| **Context Pool** | âœ…   | `server/context-pool.ts`   | Redis/Dragonfly æŒä¹…åŒ– |
| **Database**     | âœ…   | `server/database.ts`       | MongoDB æŒä¹…åŒ–         |

**éªŒè¯**: âœ… æ‰€æœ‰ Agent éƒ½åœ¨æœåŠ¡ç«¯ï¼Œæ²¡æœ‰å‰ç«¯ Agent

### 2. æ•°æ®æŒä¹…åŒ– âœ…

| æœåŠ¡                  | çŠ¶æ€      | ç”¨é€”                   |
| --------------------- | --------- | ---------------------- |
| **Redis (Dragonfly)** | âœ… å·²è¿æ¥ | Context Pool 24h ç¼“å­˜  |
| **MongoDB**           | âœ… å·²è¿æ¥ | ç”¨æˆ·æ—¥å¿—ã€çŸ¥è¯†åº“ã€é…ç½® |

**è¿æ¥ä¿¡æ¯**:

```
Redis: cgk1.clusters.zeabur.com:23465
MongoDB: cgk1.clusters.zeabur.com:27187
```

### 3. å‰ç«¯è·¯ç”± âœ…

| è·¯å¾„               | ç»„ä»¶                | çŠ¶æ€      |
| ------------------ | ------------------- | --------- |
| `/`                | é‡å®šå‘åˆ°èŠå¤©é¡µ      | âœ…        |
| `/chat`            | SimpleChatPage      | âœ…        |
| `/login`           | LoginPage           | âœ…        |
| `/admin`           | AdminLayout         | âœ… å·²ä¿®å¤ |
| `/admin/config`    | ConfigGeneratorPage | âœ…        |
| `/admin/knowledge` | KnowledgePage       | âœ…        |
| `/admin/monitor`   | MonitorPage         | âœ…        |

### 4. API è·¯ç”± âœ…

| è·¯ç”±                          | æ–¹æ³• | åŠŸèƒ½         | çŠ¶æ€ |
| ----------------------------- | ---- | ------------ | ---- |
| `/api/process-input`          | POST | å¤„ç†ç”¨æˆ·è¾“å…¥ | âœ…   |
| `/api/poll-response`          | GET  | è½®è¯¢å›å¤     | âœ…   |
| `/api/user-enter`             | POST | ç”¨æˆ·è¿›å…¥é€šçŸ¥ | âœ…   |
| `/api/chat`                   | POST | AI å…œåº•      | âœ…   |
| `/api/merchant/:id/config`    | GET  | è·å–é…ç½®     | âœ…   |
| `/api/merchant/:id/knowledge` | GET  | è·å–çŸ¥è¯†åº“   | âœ…   |

### 5. æ„å»ºçŠ¶æ€ âœ…

```bash
npm run build: âœ… æˆåŠŸï¼Œæ— é”™è¯¯
npm run lint: âœ… é€šè¿‡
```

---

## âš ï¸ å‘ç°çš„é—®é¢˜

### 1. è¿‡æ—¶æ–‡æ¡£ ğŸ“„

#### é—®é¢˜æ–‡æ¡£: `ç³»ç»Ÿæ¶æ„ä¿®æ­£ç‰ˆæ–°ï¼.md`

**é—®é¢˜**:

- æ–‡æ¡£ä¸­æåˆ°"å¾…ä¿®å¤"çš„é—®é¢˜å·²ç»ä¿®å¤
- æåˆ°å‰ç«¯ Agentï¼Œä½†å®é™…å·²å…¨éƒ¨è¿ç§»åˆ°æœåŠ¡ç«¯
- Context Pool æè¿°ä¸º"å†…å­˜æ¨¡æ‹Ÿ"ï¼Œä½†å®é™…å·²ç”¨ Redis

**å»ºè®®**: æ›´æ–°æˆ–å½’æ¡£æ­¤æ–‡æ¡£

#### é—®é¢˜æ–‡æ¡£: `é¡¹ç›®è¯Šæ–­XRay.md`

**é—®é¢˜**:

- ç¬¬ 122 è¡Œ: æåˆ°`FE_Qwen[qwen-api.ts]`ï¼Œä½†æ­¤æ–‡ä»¶å·²åˆ é™¤
- ç¬¬ 196 è¡Œ: æåˆ°`src/lib/qwen-api.ts`ï¼Œä½†æ­¤æ–‡ä»¶å·²åˆ é™¤
- Mermaid å›¾æ˜¾ç¤ºå‰ç«¯æœ‰ Agentsï¼Œä¸å®é™…ä¸ç¬¦

**å»ºè®®**: æ›´æ–° Mermaid å›¾å’Œæ–‡ä»¶æ¸…å•

### 2. å·²åˆ é™¤æ–‡ä»¶çš„å¼•ç”¨ ğŸ—‘ï¸

**å·²åˆ é™¤**:

- `src/lib/database.ts` (å‰ç«¯ä¸åº”æœ‰æ•°æ®åº“)
- `src/lib/qwen-api.ts` (å‰ç«¯ä¸åº”ç›´æ¥è°ƒç”¨ AI API)

**éªŒè¯**: âœ… ä»£ç ä¸­æ— å¼•ç”¨ï¼Œä»…æ–‡æ¡£ä¸­æœ‰æåŠ

### 3. src/lib ç›®å½•æ¸…ç† âœ…

**å½“å‰æ–‡ä»¶**:

- `api-config.ts` âœ… æ­£ç¡®ï¼ˆé€šè¿‡/api ä»£ç†ï¼‰
- `utils.ts` âœ… æ­£ç¡®ï¼ˆshadcn/ui å·¥å…·ï¼‰
- `voice-utils.ts` âœ… æ­£ç¡®ï¼ˆè¯­éŸ³å·¥å…·ï¼‰

**å·²åˆ é™¤å†—ä½™æ–‡ä»¶**: âœ…

---

## ğŸ“‹ å»ºè®®ä¿®å¤æ¸…å•

### ä¼˜å…ˆçº§ P1 - æ–‡æ¡£æ›´æ–°

1. **æ›´æ–° `ç³»ç»Ÿæ¶æ„ä¿®æ­£ç‰ˆæ–°ï¼.md`**

   - [ ] ç§»é™¤"å¾…ä¿®å¤"æ ‡è®°
   - [ ] æ›´æ–° Context Pool æè¿°ï¼ˆRedis è€Œéå†…å­˜ï¼‰
   - [ ] ç§»é™¤å‰ç«¯ Agent å¼•ç”¨

2. **æ›´æ–° `é¡¹ç›®è¯Šæ–­XRay.md`**

   - [ ] æ›´æ–° Mermaid å›¾ï¼ˆç§»é™¤å‰ç«¯ Agentsï¼‰
   - [ ] æ›´æ–°æ–‡ä»¶æ¸…å•ï¼ˆç§»é™¤å·²åˆ é™¤æ–‡ä»¶ï¼‰
   - [ ] æ·»åŠ æ³¨é‡Šè¯´æ˜ Agent åœ¨æœåŠ¡ç«¯

3. **åˆ›å»ºæ¶æ„æ€»ç»“æ–‡æ¡£**
   - [ ] å½“å‰æ­£ç¡®çš„æ¶æ„å›¾
   - [ ] æ•°æ®æµæ—¶åºå›¾
   - [ ] API è·¯ç”±æ¸…å•

### ä¼˜å…ˆçº§ P2 - ä»£ç ä¼˜åŒ–

1. **ç¯å¢ƒå˜é‡æ¸…ç†**

   - [ ] ç§»é™¤æœªä½¿ç”¨çš„ç¯å¢ƒå˜é‡
   - [ ] ç»Ÿä¸€å‘½åè§„èŒƒ

2. **ç±»å‹å®šä¹‰**
   - [ ] æ£€æŸ¥æ˜¯å¦æœ‰ any ç±»å‹
   - [ ] ç»Ÿä¸€æ¥å£å®šä¹‰

### ä¼˜å…ˆçº§ P3 - åŠŸèƒ½å¢å¼º

1. **ç›‘æ§é¢æ¿**

   - [ ] æ·»åŠ  Redis è¿æ¥çŠ¶æ€æ˜¾ç¤º
   - [ ] æ·»åŠ  MongoDB è¿æ¥çŠ¶æ€æ˜¾ç¤º

2. **é”™è¯¯å¤„ç†**
   - [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
   - [ ] æ·»åŠ é”™è¯¯æ—¥å¿—

---

## âœ… æ ¸å¿ƒéªŒè¯é€šè¿‡

### æ¶æ„æ­£ç¡®æ€§ âœ…

```
âœ… æ‰€æœ‰Agentåœ¨æœåŠ¡ç«¯ (server/agents/)
âœ… å‰ç«¯åªæœ‰UIç»„ä»¶ (src/views/, src/components/)
âœ… Context Poolä½¿ç”¨RedisæŒä¹…åŒ–
âœ… Databaseä½¿ç”¨MongoDBæŒä¹…åŒ–
âœ… APIè·¯ç”±æ­£ç¡®é…ç½®
âœ… å‰ç«¯é€šè¿‡/apiä»£ç†è®¿é—®æœåŠ¡ç«¯
```

### æ•°æ®æµæ­£ç¡®æ€§ âœ…

```
ç”¨æˆ· â†’ SimpleChatPage
     â†’ POST /api/process-input
     â†’ server/server.ts
     â†’ agentA.processInput()
     â†’ anpBus.publish()
     â†’ agentB (è½®è¯¢)
     â†’ contextPool (RedisæŸ¥è¯¢)
     â†’ agentC (çŸ¥è¯†åº“)
     â†’ anpBus.publish(B_RESPONSE)
     â†’ responseStore
     â†’ GET /api/poll-response
     â†’ å‰ç«¯æ˜¾ç¤º
```

### å®‰å…¨æ€§ âœ…

```
âœ… API Keyåœ¨æœåŠ¡ç«¯ (.env)
âœ… å‰ç«¯ä¸ç›´æ¥è°ƒç”¨AI API
âœ… æ‰€æœ‰AIè¯·æ±‚é€šè¿‡/apiä»£ç†
âœ… æ•æ„Ÿé€»è¾‘åœ¨æœåŠ¡ç«¯
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½çŠ¶æ€

| åŠŸèƒ½       | çŠ¶æ€              |
| ---------- | ----------------- |
| å¯¹è¯åŠŸèƒ½   | âœ… å®Œå…¨æ­£å¸¸       |
| çŸ¥è¯†åº“æ£€ç´¢ | âœ… å®Œå…¨æ­£å¸¸       |
| ç¼“å­˜æœºåˆ¶   | âœ… Redis æŒä¹…åŒ–   |
| æ•°æ®åº“     | âœ… MongoDB æŒä¹…åŒ– |
| åå°ç®¡ç†   | âœ… è·¯ç”±å·²ä¿®å¤     |
| æ„å»ºéƒ¨ç½²   | âœ… æ— é”™è¯¯         |

### éœ€è¦å¤„ç†çš„é—®é¢˜

1. **æ–‡æ¡£è¿‡æ—¶** (P1) - ä¸å½±å“åŠŸèƒ½ï¼Œä½†éœ€è¦æ›´æ–°
2. **æ³¨é‡Šå®Œå–„** (P2) - éƒ¨åˆ†æ–‡ä»¶éœ€è¦è¡¥å……æ³¨é‡Š
3. **ç›‘æ§å¢å¼º** (P3) - å¯ä»¥æ·»åŠ æ›´å¤šç›‘æ§æŒ‡æ ‡

### æœ€ç»ˆè¯„ä¼°

**é¡¹ç›®çŠ¶æ€**: âœ… **ç”Ÿäº§å°±ç»ª**

**æ ¸å¿ƒåŠŸèƒ½**: âœ… **å®Œæ•´å¯ç”¨**

**ä»£ç è´¨é‡**: âœ… **è‰¯å¥½**

**æ–‡æ¡£çŠ¶æ€**: âš ï¸ **éƒ¨åˆ†è¿‡æ—¶ï¼Œéœ€è¦æ›´æ–°**

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ

1. âœ… éªŒè¯æ„å»º - å·²å®Œæˆ
2. âœ… éªŒè¯æ•°æ®åº“è¿æ¥ - å·²å®Œæˆ
3. âœ… ä¿®å¤ Admin è·¯ç”± - å·²å®Œæˆ

### å»ºè®®æ‰§è¡Œ

1. æ›´æ–°è¿‡æ—¶æ–‡æ¡£
2. åˆ›å»ºæœ€æ–°æ¶æ„å›¾
3. è¡¥å……ä»£ç æ³¨é‡Š

### å¯é€‰æ‰§è¡Œ

1. æ·»åŠ å•å…ƒæµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç›‘æ§é¢æ¿å¢å¼º

---

**æ£€æŸ¥å®Œæˆæ—¶é—´**: 2026-01-16 04:20
**æ£€æŸ¥ç»“è®º**: âœ… é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨

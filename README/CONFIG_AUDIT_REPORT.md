# ğŸ“‹ ç³»ç»Ÿé…ç½®ç”Ÿæ•ˆæ’æŸ¥æŠ¥å‘Š

**æ’æŸ¥æ—¥æœŸ**: 2026-01-20 07:04  
**é¡¹ç›®ç‰ˆæœ¬**: 4.0

---

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

| ç›®å½•                                 | ç”¨é€”         | å½“å‰çŠ¶æ€                      |
| ------------------------------------ | ------------ | ----------------------------- |
| `server/merchant/dongli/config.json` | **åç«¯ä½¿ç”¨** | âœ… æœ€æ–°(ä½ ä¿®æ”¹çš„Promptåœ¨è¿™é‡Œ) |
| `public/data/dongli/config.json`     | **å‰ç«¯ä½¿ç”¨** | âš ï¸ æ—§ç‰ˆ(PromptæœªåŒæ­¥)         |

### âš ï¸ é—®é¢˜å‘ç°ï¼šä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸åŒæ­¥ï¼

**server/merchant/dongli/config.json** çš„system prompt:

```
ä½ æ˜¯ä¸€ä¸ªæ‘å­ä¸œé‡Œæ‘çš„æ‘æ”¯ä¹¦ä¹¦è®°ï¼Œä½ å¯¹æœ¬æ‘çš„å†å¹´çš„ï¼ˆä»é©å‘½æ—¶æœŸåˆ°ç°åœ¨...
```

**public/data/dongli/config.json** çš„system prompt:

```
ä½ æ˜¯ä¸œé‡Œæ‘çš„æ™ºèƒ½å¯¼æ¸¸åŠ©æ‰‹ï¼Œè¯·å‹å¥½ã€ä¸“ä¸šåœ°å›ç­”æ¸¸å®¢çš„é—®é¢˜...
```

---

## ğŸ”„ é…ç½®è¯»å–é€»è¾‘

### åç«¯ (server/config-manager.ts)

```
1. ä¼˜å…ˆè¯»å–: server/merchant/{id}/config.json  â† âœ… ä½ ä¿®æ”¹çš„åœ¨è¿™é‡Œ
2. é™çº§è¯»å–: public/data/{id}/config.json
3. æœ€åä½¿ç”¨: ç¡¬ç¼–ç é»˜è®¤å€¼
```

**ç»“æœ**: âœ… åç«¯ä½¿ç”¨çš„æ˜¯ä½ ä¿®æ”¹çš„Prompt

### å‰ç«¯ (src/core/config-manager.ts)

```
1. è¯»å–: /data/{id}/config.json (å³ public/data/...)
```

**ç»“æœ**: âš ï¸ å‰ç«¯è¯»å–çš„æ˜¯æ—§é…ç½®

---

## ğŸ“Š é…ç½®é¡¹ç”Ÿæ•ˆçŠ¶æ€

### âœ… å·²ç”Ÿæ•ˆ (åç«¯)

| é…ç½®é¡¹           | æ–‡ä»¶                            | ä½¿ç”¨ä½ç½®        | çŠ¶æ€ |
| ---------------- | ------------------------------- | --------------- | ---- |
| prompts.system   | server/merchant/.../config.json | Agent B askAI() | âœ…   |
| prompts.welcome  | åŒä¸Š                            | åç«¯å…œåº•        | âœ…   |
| prompts.chitchat | åŒä¸Š                            | Agent Bé—²èŠ     | âœ…   |

### âš ï¸ éƒ¨åˆ†ç”Ÿæ•ˆ (å‰ç«¯)

| é…ç½®é¡¹          | æ–‡ä»¶                        | ä½¿ç”¨ä½ç½®            | çŠ¶æ€        |
| --------------- | --------------------------- | ------------------- | ----------- |
| prompts.welcome | public/data/.../config.json | SimpleChatPage      | âš ï¸ ä½¿ç”¨æ—§å€¼ |
| theme.title     | åŒä¸Š                        | SimpleChatPage æ ‡é¢˜ | âš ï¸ ä½¿ç”¨æ—§å€¼ |
| name            | åŒä¸Š                        | DashboardPage       | âš ï¸ ä½¿ç”¨æ—§å€¼ |

### âŒ æœªä½¿ç”¨çš„é…ç½®

| é…ç½®é¡¹             | åŸå›                             |
| ------------------ | ------------------------------- |
| apiConfig.asr      | åç«¯ä½¿ç”¨ç¯å¢ƒå˜é‡,ä¸è¯»å–é…ç½®     |
| apiConfig.tts      | åç«¯ä½¿ç”¨ç¯å¢ƒå˜é‡,ä¸è¯»å–é…ç½®     |
| apiConfig.llm      | åç«¯ä½¿ç”¨ç¯å¢ƒå˜é‡,ä¸è¯»å–é…ç½®     |
| hotQAs             | åªåœ¨public/dataä¸­,Agent Bæœªè¯»å– |
| theme.primaryColor | å‰ç«¯æœªå®ç°åŠ¨æ€ä¸»é¢˜              |
| cache.ttl          | ä¸¤è¾¹é…ç½®ä¸åŒ(300 vs 86400)      |

---

## ğŸ”§ éœ€è¦ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1: é…ç½®ä¿å­˜æ—¶æœªåŒæ­¥åˆ°public/data

**ç°è±¡**: åå°ä¿å­˜é…ç½®åªæ›´æ–°`server/merchant/`ï¼Œä¸æ›´æ–°`public/data/`

**ä½ç½®**: `server/server.ts` PUT `/api/merchant/:id/config`

**ä¿®å¤**: ä¿å­˜æ—¶åŒæ—¶å†™å…¥ä¸¤ä¸ªä½ç½®

### é—®é¢˜2: åç«¯æœªè¯»å–apiConfig

**ç°è±¡**: é…ç½®çš„ASR/TTS/LLM providerè¢«å¿½ç•¥,ä½¿ç”¨ç¯å¢ƒå˜é‡

**ä½ç½®**: `server/services/api-service.ts`, `server/agents/agent-b.ts`

**ç°çŠ¶**: å¯æ¥å—(ç›®å‰ç”¨ç¯å¢ƒå˜é‡æ›´å®‰å…¨)

### é—®é¢˜3: hotQAsæœªè¢«Agent Bä½¿ç”¨

**ç°è±¡**: é…ç½®çš„çƒ­é—¨é—®ç­”æ²¡æœ‰ç”Ÿæ•ˆ

**ä½ç½®**: Agent Båº”è¯¥å…ˆæ£€æŸ¥hotQAså†è°ƒç”¨C

**ä¿®å¤**: éœ€è¦åœ¨Agent Bä¸­æ·»åŠ çƒ­é—¨é—®ç­”æ£€æŸ¥

---

## ğŸ“‹ å®Œæ•´é…ç½®é¡¹æ¸…å•

### ç”Ÿæ•ˆé…ç½® âœ…

| é…ç½®é¡¹           | åç«¯             | å‰ç«¯    | è¯´æ˜        |
| ---------------- | ---------------- | ------- | ----------- |
| merchantId       | âœ…               | âœ…      | æ¥è‡ªURLå‚æ•° |
| name             | âœ… configManager | âš ï¸ æ—§å€¼ | éœ€è¦åŒæ­¥    |
| prompts.system   | âœ… Agent B       | N/A     | åç«¯ä¸“ç”¨    |
| prompts.welcome  | âœ… å…œåº•          | âš ï¸ æ—§å€¼ | éœ€è¦åŒæ­¥    |
| prompts.chitchat | âœ… Agent B       | N/A     | åç«¯ä¸“ç”¨    |
| theme.title      | N/A              | âš ï¸ æ—§å€¼ | éœ€è¦åŒæ­¥    |

### æœªä½¿ç”¨é…ç½® âŒ

| é…ç½®é¡¹             | åŸå›          | å»ºè®®           |
| ------------------ | ------------ | -------------- |
| apiConfig.\*       | ä½¿ç”¨ç¯å¢ƒå˜é‡ | ä¿æŒç°çŠ¶(å®‰å…¨) |
| hotQAs             | æœªå®ç°       | P2ä¼˜åŒ–         |
| theme.primaryColor | æœªå®ç°       | P3å¯é€‰         |
| cache.\*           | ä¸¤è¾¹é…ç½®ä¸åŒ | éœ€è¦ç»Ÿä¸€       |
| dataSource         | æœªä½¿ç”¨       | æœªæ¥æ‰©å±•       |

---

## ğŸ¯ ç«‹å³ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: ä¿å­˜é…ç½®æ—¶åŒæ­¥ä¸¤ä¸ªç›®å½•

åœ¨ `server/server.ts` çš„ PUT `/api/merchant/:id/config` ä¸­æ·»åŠ :

```typescript
// 1. ä¿å­˜åˆ°server/merchantç›®å½•
await fs.writeFile(serverPath, JSON.stringify(config, null, 2));

// 2. åŒæ­¥åˆ°public/dataç›®å½•(ä¾›å‰ç«¯ä½¿ç”¨)
await fs.writeFile(publicPath, JSON.stringify(config, null, 2));
```

### ä¿®å¤2: æ‰‹åŠ¨åŒæ­¥å½“å‰é…ç½®

å°† `server/merchant/dongli/config.json` å¤åˆ¶åˆ° `public/data/dongli/config.json`

---

## ğŸ“ˆ ä¼˜å…ˆçº§æ’åº

| ä¼˜å…ˆçº§ | é—®é¢˜            | å½±å“                    |
| ------ | --------------- | ----------------------- |
| **P0** | é…ç½®ä¸åŒæ­¥      | å‰ç«¯æ˜¾ç¤ºæ—§çš„æ¬¢è¿è¯­/æ ‡é¢˜ |
| **P1** | hotQAsæœªä½¿ç”¨    | çƒ­é—¨é—®é¢˜æ— æ³•ç¼“å­˜å‘½ä¸­    |
| **P2** | ä¸»é¢˜è‰²æœªä½¿ç”¨    | UIæ— æ³•å®šåˆ¶              |
| **P3** | cacheé…ç½®ä¸ä¸€è‡´ | å¯èƒ½å¯¼è‡´ç¼“å­˜ç­–ç•¥æ··ä¹±    |

---

**ç»“è®º**: æœ€å…³é”®çš„é—®é¢˜æ˜¯**é…ç½®ä¿å­˜æ—¶æœªåŒæ­¥åˆ°ä¸¤ä¸ªç›®å½•**ï¼Œå¯¼è‡´å‰ç«¯è¯»å–çš„æ˜¯æ—§é…ç½®ã€‚

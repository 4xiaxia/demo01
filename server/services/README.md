# è¯­éŸ³æœåŠ¡æ¨¡å—è¯´æ˜

> åˆ›å»ºæ—¶é—´ï¼š2026-01-20  
> æœ€åæ›´æ–°ï¼š2026-01-20  
> æ¶æ„åŸåˆ™ï¼šç‹¬ç«‹æ–‡ä»¶ã€æ¸…æ™°éš”ç¦»ã€è§„çŸ©åˆ†å‘ã€ä¼˜å…ˆæœ€ç¨³

## ğŸ“ ç›®å½•ç»“æ„

```
server/services/
â”œâ”€â”€ tts/                          # TTS è¯­éŸ³åˆæˆæœåŠ¡
â”‚   â”œâ”€â”€ tts-dashscope.ts          # âœ… é˜¿é‡Œäº‘ TTS (HTTP) - ä¼˜å…ˆä½¿ç”¨
â”‚   â””â”€â”€ tts-zhipu.ts              # âœ… æ™ºè°± TTS (HTTP) - å¤‡ç”¨æ–¹æ¡ˆ
â”œâ”€â”€ asr/                          # ASR è¯­éŸ³è¯†åˆ«æœåŠ¡
â”‚   â”œâ”€â”€ asr-zhipu.ts              # âœ…âœ…âœ… æ™ºè°± ASR (HTTP) - æœ€ç¨³æ–¹æ¡ˆ
â”‚   â””â”€â”€ asr-dashscope-ws.ts       # âš ï¸ é˜¿é‡Œäº‘ ASR (WebSocket) - æœªæ¥å¯é€‰
â”œâ”€â”€ api-service.ts                # ç»Ÿä¸€è·¯ç”±åˆ†å‘å™¨ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## ğŸ¯ æœåŠ¡é€‰å‹çŸ©é˜µ

### TTS è¯­éŸ³åˆæˆ

| æœåŠ¡        | çŠ¶æ€      | ç¨³å®šæ€§     | å¤æ‚åº¦          | åŠŸèƒ½            | æ¨è    | æ–‡ä»¶                                       |
| ----------- | --------- | ---------- | --------------- | --------------- | ------- | ------------------------------------------ |
| é˜¿é‡Œäº‘ HTTP | âœ… å·²å®ç° | â­â­â­â­â­ | â­â­â­â­â­ ç®€å• | â­â­â­â­â­ ä¸°å¯Œ | âœ… ä¼˜å…ˆ | [tts-dashscope.ts](./tts/tts-dashscope.ts) |
| æ™ºè°± HTTP   | âœ… å·²å®ç° | â­â­â­â­â­ | â­â­â­â­â­ ç®€å• | â­â­â­ åŸºç¡€     | âœ… å¤‡ç”¨ | [tts-zhipu.ts](./tts/tts-zhipu.ts)         |

**æ¨èé…ç½®**ï¼š

```json
{
  "tts": {
    "primary": "dashscope",
    "backup": ["zhipu"]
  }
}
```

### ASR è¯­éŸ³è¯†åˆ«

| æœåŠ¡             | çŠ¶æ€      | ç¨³å®šæ€§      | å¤æ‚åº¦          | åŠŸèƒ½            | æ¨è        | æ–‡ä»¶                                             |
| ---------------- | --------- | ----------- | --------------- | --------------- | ----------- | ------------------------------------------------ |
| æ™ºè°± HTTP        | âœ… å·²å®ç° | â­â­â­â­â­  | â­â­â­â­â­ ç®€å• | â­â­â­ å¤Ÿç”¨     | âœ…âœ…âœ… æœ€ç¨³ | [asr-zhipu.ts](./asr/asr-zhipu.ts)               |
| é˜¿é‡Œäº‘ WebSocket | âš ï¸ æœªå®ç° | â­â­â­ å¾…æµ‹ | â­â­ å¤æ‚       | â­â­â­â­â­ æœ€å¼º | âš ï¸ æœªæ¥     | [asr-dashscope-ws.ts](./asr/asr-dashscope-ws.ts) |

**æ¨èé…ç½®**ï¼š

```json
{
  "asr": {
    "primary": "zhipu", // âœ… æœ€ç¨³æ–¹æ¡ˆ
    "backup": []
  }
}
```

## âš ï¸ å…³é”®å·®å¼‚å¯¹ç…§

### TTS å‚æ•°å·®å¼‚

| å‚æ•°           | é˜¿é‡Œäº‘ DashScope | æ™ºè°± GLM   | æ³¨æ„      |
| -------------- | ---------------- | ---------- | --------- |
| **è¯­é€Ÿå‚æ•°å** | `rate`           | `speed`    | âš ï¸ ä¸åŒï¼ |
| **éŸ³è‰²**       | `longxiaoxia_v3` | `female`   | âš ï¸ ä¸åŒï¼ |
| **é‡‡æ ·ç‡**     | `22050` Hz       | `24000` Hz | âš ï¸ ä¸åŒï¼ |
| **æ ¼å¼**       | `mp3`            | `wav`      | âš ï¸ ä¸åŒï¼ |
| **éŸ³é‡**       | âœ… æ”¯æŒ          | âŒ ä¸æ”¯æŒ  | -         |
| **éŸ³è°ƒ**       | âœ… æ”¯æŒ          | âŒ ä¸æ”¯æŒ  | -         |

### ASR æ–¹å¼å·®å¼‚

| ç‰¹æ€§           | æ™ºè°± HTTP     | é˜¿é‡Œäº‘ WebSocket |
| -------------- | ------------- | ---------------- |
| **è¾“å…¥æ–¹å¼**   | FormData ä¸Šä¼  | WebSocket æµå¼   |
| **æ—¶é•¿é™åˆ¶**   | â‰¤60ç§’ âš ï¸      | æ— é™åˆ¶ âœ…        |
| **è¯­è¨€æ”¯æŒ**   | ä»…ä¸­æ–‡        | å¤šè¯­ç§+æ–¹è¨€ âœ…   |
| **å®ç°å¤æ‚åº¦** | ç®€å• âœ…       | å¤æ‚ âŒ          |
| **ç¨³å®šæ€§**     | é«˜ âœ…         | éœ€æµ‹è¯• âš ï¸        |

## ğŸ“‹ æ¯ä¸ªæ–‡ä»¶åŒ…å«çš„ä¿¡æ¯

æ¯ä¸ªç‹¬ç«‹æœåŠ¡æ–‡ä»¶éƒ½åŒ…å«ä»¥ä¸‹å®Œæ•´ä¿¡æ¯ï¼š

### 1. åŸºæœ¬ä¿¡æ¯

- æä¾›å•†
- æ¨¡å‹åç§°
- åè®®ç±»å‹
- API ç«¯ç‚¹

### 2. ç‰¹æ€§è¯„çº§

- ç¨³å®šæ€§è¯„åˆ†
- å¤æ‚åº¦è¯„åˆ†
- åŠŸèƒ½æ€§è¯„åˆ†
- æ¨èåº¦

### 3. æ ¸å¿ƒå‚æ•°

- æ‰€æœ‰å¯é…ç½®å‚æ•°
- å‚æ•°èŒƒå›´å’Œé»˜è®¤å€¼
- ç‰¹æ®Šé™åˆ¶

### 4. å…³é”®æ³¨æ„äº‹é¡¹

- âš ï¸ å¿…é¡»æ³¨æ„çš„å·®å¼‚
- âŒ å¸¸è§é”™è¯¯
- âœ… æ­£ç¡®åšæ³•

### 5. å®ç°ç»†èŠ‚

- å®Œæ•´çš„å‡½æ•°å®ç°
- é”™è¯¯å¤„ç†
- æ—¥å¿—è¾“å‡º
- ç±»å‹å®šä¹‰

### 6. ä½¿ç”¨ç¤ºä¾‹

- è°ƒç”¨ç¤ºä¾‹
- è¿”å›å€¼è¯´æ˜
- ç‰¹æ®Šæƒ…å†µå¤„ç†

### 7. å¯¹æ¯”è¯´æ˜

- ä¸å…¶ä»–æœåŠ¡çš„å¯¹æ¯”
- ä¼˜åŠ¿å’ŒåŠ£åŠ¿
- é€‚ç”¨åœºæ™¯

## ğŸ”„ API è·¯ç”±è§„åˆ™

### ç»Ÿä¸€è°ƒç”¨å…¥å£ï¼ˆapi-service.tsï¼‰

```typescript
// TTS è°ƒç”¨
import { callDashScopeTTS } from "./tts/tts-dashscope";
import { callZhipuTTS } from "./tts/tts-zhipu";

export async function textToSpeech(text, voice) {
  // 1. å°è¯•é˜¿é‡Œäº‘ï¼ˆä¸»ï¼‰
  const result = await callDashScopeTTS(text, voice);
  if (result.success) return result;

  // 2. é™çº§åˆ°æ™ºè°±ï¼ˆå¤‡ï¼‰
  return await callZhipuTTS(text, voice);
}

// ASR è°ƒç”¨
import { callZhipuASR } from "./asr/asr-zhipu";

export async function speechToText(audioBuffer) {
  // ä¼˜å…ˆä½¿ç”¨æ™ºè°±ï¼ˆæœ€ç¨³ï¼‰
  return await callZhipuASR(audioBuffer);
}
```

**è·¯ç”±è§„åˆ™**ï¼š

1. âœ… æŒ‰é…ç½®ä¼˜å…ˆçº§è°ƒç”¨
2. âœ… è‡ªåŠ¨é™çº§å¤‡ç”¨æ–¹æ¡ˆ
3. âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
4. âœ… ç»Ÿä¸€æ—¥å¿—è®°å½•
5. âŒ ä¸å…è®¸è·¨æœåŠ¡ä¹±é£

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

```typescript
// 1. TTS è°ƒç”¨
import { callDashScopeTTS } from "./services/tts/tts-dashscope";

const result = await callDashScopeTTS("ä½ å¥½ä¸–ç•Œ", "female");
if (result.success) {
  console.log("éŸ³é¢‘:", result.data.audioBase64);
  console.log("æ ¼å¼:", result.data.format); // "mp3"
}

// 2. ASR è°ƒç”¨
import { callZhipuASR } from "./services/asr/asr-zhipu";

const result = await callZhipuASR(audioBuffer);
if (result.success) {
  console.log("æ–‡æœ¬:", result.data.text);
}
```

### æ£€æŸ¥æœåŠ¡å¯ç”¨æ€§

```typescript
import { isDashScopeTTSAvailable } from "./services/tts/tts-dashscope";
import { isZhipuASRAvailable } from "./services/asr/asr-zhipu";

if (isDashScopeTTSAvailable()) {
  console.log("âœ… é˜¿é‡Œäº‘ TTS å¯ç”¨");
}

if (isZhipuASRAvailable()) {
  console.log("âœ… æ™ºè°± ASR å¯ç”¨");
}
```

## ğŸš€ æœªæ¥æ‰©å±•

### Phase 1: å½“å‰é˜¶æ®µï¼ˆå·²å®Œæˆï¼‰âœ…

- [x] TTS: é˜¿é‡Œäº‘ + æ™ºè°± HTTP
- [x] ASR: æ™ºè°± HTTPï¼ˆæœ€ç¨³æ–¹æ¡ˆï¼‰
- [x] ç‹¬ç«‹æ–‡ä»¶ç»“æ„
- [x] è¯¦ç»†æ³¨æ„äº‹é¡¹

### Phase 2: æœªæ¥å¯é€‰ï¼ˆæŒ‰éœ€å®ç°ï¼‰

- [ ] ASR: é˜¿é‡Œäº‘ WebSocket å®æ—¶æµå¼
- [ ] å®Œæ•´çš„ WebSocket è¿æ¥ç®¡ç†
- [ ] éŸ³é¢‘æ ¼å¼è½¬æ¢å·¥å…·
- [ ] æ›´å¤šè¯­è¨€å’Œæ–¹è¨€æ”¯æŒ

**è§¦å‘æ¡ä»¶**ï¼š

- éœ€è¦è¯†åˆ«è¶…è¿‡ 60 ç§’çš„éŸ³é¢‘
- éœ€è¦å¤šè¯­ç§/æ–¹è¨€è¯†åˆ«
- éœ€è¦å®æ—¶æµå¼è¯†åˆ«
- éœ€è¦è¯´è¯äººåˆ†ç¦»åŠŸèƒ½

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [TTS API å·®å¼‚è¯´æ˜](../../TTS_API_å·®å¼‚è¯´æ˜.md)
- [ASR API å·®å¼‚è¯´æ˜](../../ASR_API_å·®å¼‚è¯´æ˜.md)
- [å®˜æ–¹ç¤ºä¾‹ä»£ç ](../../public/alibabacloud-bailian-speech-demo-master/)

## âš¡ æ€§èƒ½ä¼˜åŒ–

### TTS ä¼˜åŒ–å»ºè®®

1. âœ… æ–‡æœ¬åˆ†å—ï¼ˆ<500å­—/å—ï¼‰
2. âœ… å¹¶è¡Œå¤„ç†ï¼ˆæ–‡æœ¬æ˜¾ç¤º + TTSè¯·æ±‚ï¼‰
3. âœ… ç¼©çŸ­è½®è¯¢é—´éš”ï¼ˆ200msï¼‰
4. âœ… ä½¿ç”¨ MP3 æ ¼å¼ï¼ˆæ–‡ä»¶æ›´å°ï¼‰

### ASR ä¼˜åŒ–å»ºè®®

1. âœ… æ§åˆ¶éŸ³é¢‘æ—¶é•¿ï¼ˆ<60ç§’ï¼‰
2. âœ… ä½¿ç”¨ WAV æ ¼å¼ï¼ˆå…¼å®¹æ€§å¥½ï¼‰
3. âœ… å‰ç«¯éªŒè¯ï¼ˆé¿å…æ— æ•ˆè¯·æ±‚ï¼‰
4. âœ… é”™è¯¯æç¤ºæ˜ç¡®ï¼ˆæ—¶é•¿/æ ¼å¼ï¼‰

---

**ç»´æŠ¤è¯´æ˜**ï¼š

- æ¯ä¸ªæœåŠ¡æ–‡ä»¶ç‹¬ç«‹ç»´æŠ¤
- ä¿®æ”¹æ—¶å¿…é¡»åŒæ­¥æ›´æ–°æ³¨é‡Š
- æ–°å¢æœåŠ¡å¿…é¡»éµå¾ªç›¸åŒè§„èŒƒ
- ä¿æŒå‘åå…¼å®¹æ€§
